schedules:
- cron: "0 20 * * Sun,Tue,Thu"
  displayName: 8pm Sunday, Tuesday, Thursday
  branches:
    include:
    - master
  always: true

pool:
  vmImage: 'ubuntu-latest'

steps:
- task: DotNetCoreInstaller@0
  displayName: 'Install .NET Core SDK'
  inputs:
    version: 2.1.403

- task: DotNetCoreCLI@2
  displayName: 'install NuKeeper'
  inputs:
    command: custom
    custom: 'tool '
    arguments: 'install -g NuKeeper'

- script: 'git config --global user.email %git_email%' 
  displayName: 'Set git email address'

- script: 'git config --global user.name %git_username%' 
  displayName: 'Set git user name'

- script: 'nukeeper org HelpMyStreet $(NUKEEPER_GITHUB_TOKEN) --maxrepo 99 --maxpackageupdates 99 --consolidate --fork PreferSingleRepository' 
  displayName: 'Run NuKeeper (All packages, min age 7 days)'

- script: 'nukeeper org HelpMyStreet $(NUKEEPER_GITHUB_TOKEN) --maxrepo 99 --maxpackageupdates 99 --consolidate --fork PreferSingleRepository --source https://pkgs.dev.azure.com/HelpMyStreet/nuget-package/_packaging/nuget.HelpMyStreet/nuget/v3/index.json --age 0' 
  displayName: 'Run NuKeeper (HMS packages, min age 0 days)'